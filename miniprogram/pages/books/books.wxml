<view class="container">
  <view class="search-bar">
    <input placeholder="搜索图书" bindinput="onSearchInput" />
  </view>
  <view class="books-list">
    <view class="book-item" wx:for="{{books}}" wx:key="{{item._id}}">
      <image src="/images/book.png" class="book-img"></image>
      <view class="book-info">
        <text class="book-title">{{item.name}}</text>
        <text class="book-author">作者: {{item.author}}</text>
        <text class="book-status {{item.status === 'available' ? 'status-available' : (item.status === 'pending' ? 'status-pending' : 'status-borrowed')}}">
          {{item.status === 'available' ? '可借阅' : (item.status === 'pending' ? '待审批' : '已借出')}}
        </text>
        <!-- 新增：显示借阅人信息（所有用户可见） -->
        <text class="book-borrower" wx:if="{{item.status === 'borrowed' && item.currentBorrowerName}}">
          借阅人: {{item.currentBorrowerName}}
        </text>
      </view>
      <view class="book-actions">
        <button bindtap="handleBorrow" data-id="{{item._id}}" data-name="{{item.name}}" wx:if="{{item.status === 'available'}}">
          借阅
        </button>
        <button bindtap="handleReturn" data-id="{{item._id}}" data-name="{{item.name}}" wx:if="{{item.status === 'borrowed' && item.currentBorrower === openid}}">
          归还
        </button>
      </view>
    </view>
  </view>
</view>