<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <input 
      placeholder="搜索图书名称/作者" 
      value="{{searchKey}}"
      bindinput="onSearchInput"
      type="text"
    />
  </view>
  <view class="books-list">
    <view class="book-item" wx:for="{{filteredBooks}}" wx:key="{{item._id}}" bindtap="gotoBookDetail" data-id="{{item._id}}" 
    >
      <image src="/images/book.png" class="book-img"></image>
      <view class="book-info">
        <text class="book-title">{{item.name}}</text>
        <text class="book-author">作者: {{item.author}}</text>
        <text class="book-status {{item.status === 'available' ? 'status-available' : (item.status === 'pending' ? 'status-pending' : 'status-borrowed')}}">
          {{item.status === 'available' ? '可借阅' : (item.status === 'pending' ? '待审批' : '已借出')}}
        </text>
        <!-- 显示真实姓名 -->
        <text class="book-borrower" wx:if="{{item.status === 'borrowed' && item.currentBorrowerName}}">
          借阅人: {{item.currentBorrowerName}}
        </text>
      </view>
      <view class="book-actions">
        <!-- 在借阅按钮中添加禁用状态 -->
        <button catchtap="handleBorrow" data-id="{{item._id}}" data-name="{{item.name}}" wx:if="{{item.status === 'available'}}" disabled="{{borrowingBookIds.includes(item._id)}}"  class="{{borrowingBookIds.includes(item._id) ? 'btn-disabled' : ''}}">
          {{borrowingBookIds.includes(item._id) ? '提交中...' : '借阅'}}
        </button>
        <button catchtap="handleReturn" data-id="{{item._id}}" data-name="{{item.name}}" wx:if="{{item.status === 'borrowed' && item.currentBorrower === openid}}">
          归还
        </button>
      </view>
    </view>
    <!-- 空状态提示 -->
    <view class="empty-tip" wx:if="{{filteredBooks.length === 0 && searchKey}}">
      未找到“{{searchKey}}”相关的图书
    </view>
    <view class="empty-tip" wx:if="{{filteredBooks.length === 0 && !searchKey && books.length === 0}}">
      暂无图书数据
    </view>
  </view>
</view>